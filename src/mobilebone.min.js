/**! 
 * @author @copyright zhangxinxu(.com) 
 * @since 2014-09-26
 * @description mobilebone.js(v2.8.1) - bone of switch for mobile web app - https://github.com/zhangxinxu/mobilebone
 * @license MIT
**/
(function(root,factory){if(document.MBLOADED){root.console&&console.warn("Don't repeat load Mobilebone!");return}if(typeof define==="function"&&(define.amd||define.cmd)){define("mobilebone",(function(exports){return factory(root,exports)}))}else if(typeof module==="object"&&typeof module.exports==="object"){module.exports=factory(root,{})}else{root.Mobilebone=factory(root,{})}})(typeof global!=="undefined"?global:typeof window!=="undefined"?window:typeof self!=="undefined"?self:this,(function(root,Mobilebone){var store={};var array=[];var slice=array.slice;var isSimple=/^#?\w+(?:[\-_]\w+)*$/i;var isWebkit="WebkitAppearance"in document.documentElement.style||typeof document.webkitHidden!="undefined";var supportHistory="pushState"in history&&"replaceState"in history;Mobilebone.support=supportHistory;var hasInited=false;Mobilebone.VERSION="2.8.1";Mobilebone.autoInit=true;Mobilebone.captureLink=true;Mobilebone.captureForm=true;Mobilebone.rootTransition=root;Mobilebone.mergeCallback=true;Mobilebone.classAnimation="slide";Mobilebone.classPage="page";Mobilebone.classMask="mask";Mobilebone.pushStateEnabled=true;Mobilebone.evalScript=false;if(navigator.userAgent.indexOf("Firefox")>=0&&window.top!==window){Mobilebone.pushStateEnabled=false}if(supportHistory==false){return Mobilebone}history.popstate=false;Mobilebone.transition=function(pageInto,pageOut,back,options){if(arguments.length==0||pageInto==pageOut)return;if(arguments.length==3&&isNaN(back*1)==true){options=back;back=options.back}pageOut=pageOut||null,back=back||false,options=options||{};var defaults={root:this.rootTransition,form:this.form||this.classAnimation,onpagefirstinto:this.onpagefirstinto,animationstart:this.animationstart,animationend:this.animationend,preventdefault:this.preventdefault,fallback:this.fallback,callback:this.callback},params=function(element){if(!element||!element.getAttribute)return{};var _params={},_dataparams=_queryToObject(element.getAttribute("data-params")||"");["title","root","form"].forEach((function(key){_params[key]=element.getAttribute("data-"+key)||_dataparams[key]||options[key]||defaults[key]}));if(typeof _params.root=="string"){_params.root=Mobilebone.getFunction(_params.root)}["onpagefirstinto","callback","fallback","animationstart","animationend","preventdefault"].forEach((function(key){if(Mobilebone.mergeCallback==true&&typeof defaults[key]=="function"){var local_function_key=element.getAttribute("data-"+key)||_dataparams[key];if(typeof _params.root[local_function_key]=="function"){_params[key]=function(){defaults[key].apply(this,arguments);_params.root[local_function_key].apply(this,arguments)}}else if(typeof options[key]=="function"){_params[key]=function(){defaults[key].apply(this,arguments);options[key].apply(this,arguments)}}else{_params[key]=defaults[key]}}else{_params[key]=element.getAttribute("data-"+key)||_dataparams[key]||options[key]||defaults[key]}}));return _params};var paramsOut=params(pageOut),paramsIn=params(pageInto);if(pageOut!=null&&pageOut.classList){var preventOut=paramsOut.preventdefault,isPreventOut=false;if(typeof preventOut=="string"){preventOut=paramsOut.root[preventOut]}}if(pageInto!=null&&pageInto.classList){var preventInto=paramsIn.preventdefault,isPreventInto=false;if(typeof preventInto=="string"){preventInto=paramsIn.root[preventInto]}}if(typeof preventOut=="function"){isPreventOut=preventOut.call(paramsOut.root,pageInto,pageOut,options)}if(isPreventOut==true&&preventOut===preventInto){return false}if(typeof preventInto=="function"){isPreventInto=preventInto.call(paramsIn.root,pageInto,pageOut,options)}if(isPreventInto==true){return false}var funAnimationCall=function(page,data){if(page.flagAniBind==true)return;["animationstart","animationend"].forEach((function(animationkey,index){var animition=paramsIn[animationkey],webkitkey="webkit"+animationkey.replace(/^a|s|e/g,(function(matchs){return matchs.toUpperCase()}));var animateEventName=isWebkit?webkitkey:animationkey;if(index){page.addEventListener(animateEventName,(function(){if(this.classList.contains("in")==false){this.style.display="none"}this.classList.remove(params(this).form)}))}if(typeof animition=="string"&&paramsIn.root[animition]){page.addEventListener(animateEventName,(function(){data.root[animition].call(data.root,this,this.classList.contains("in")?"into":"out",options)}))}else if(typeof animition=="function"){page.addEventListener(animateEventName,(function(){animition.call(data.root,this,this.classList.contains("in")?"into":"out",options)}))}page.flagAniBind=true}))};if(pageOut!=null&&pageOut.classList){if(isPreventOut!=true){pageOut.classList.add(paramsOut.form);pageOut.offsetWidth;pageOut.style.display="block";pageOut.classList.add("out");pageOut.classList.remove("in");pageOut.classList[back?"add":"remove"]("reverse");pageOut.removeSelf=pageOut.removeSelf||null;funAnimationCall(pageOut,paramsOut);var fallback=paramsOut.fallback;if(typeof fallback=="string"){fallback=paramsOut.root[fallback]}if(typeof fallback=="function"){fallback.call(paramsOut.root,pageInto,pageOut,options)}}}if(pageInto!=null&&pageInto.classList){var title=paramsIn.title,header=document.querySelector("h1"),firstPage=document.querySelector("."+this.classPage);if(title&&options.title!==false){document.title=title;if(header){header.innerHTML=title;header.title=title}}else if(firstPage==pageInto&&!pageOut&&document.title){pageInto.setAttribute("data-title",document.title)}var pageid=options.id||pageInto.id;var hashid=options.id||pageInto.id;if(pageOut){pageInto.classList.add(paramsIn.form)}pageInto.offsetWidth;pageInto.style.display="block";pageInto.classList.remove("out");pageInto.classList.add("in");pageInto.classList[back?"add":"remove"]("reverse");var onpagefirstinto=paramsIn.onpagefirstinto;if(!pageInto.firstintoBind){if(typeof onpagefirstinto=="string"&&paramsIn.root[onpagefirstinto]){paramsIn.root[onpagefirstinto].call(paramsIn.root,pageInto,pageOut,options)}else if(typeof onpagefirstinto=="function"){onpagefirstinto.call(paramsIn.root,pageInto,pageOut,options)}slice.call(pageInto.querySelectorAll("form")).forEach((function(form){Mobilebone.submit(form)}));pageInto.firstintoBind=true}funAnimationCall(pageInto,paramsIn);var urlPush=hashid,urlPushReplace="";if(urlPush&&/#/.test(urlPush)==false){urlPush="#"+urlPush}urlPushReplace=urlPush.replace(/#/,"#&");if(supportHistory&&this.pushStateEnabled&&options.history!==false&&urlPush&&urlPushReplace!=location.hash){history.popstate=false;history[pageOut?"pushState":"replaceState"](null,document.title,urlPush.replace(/#/,"#&"))}if(!store[pageid]){store[pageid]=pageInto}var callback=paramsIn.callback;if(typeof callback=="string"){callback=paramsIn.root[callback]}if(typeof callback=="function"){callback.call(paramsIn.root,pageInto,pageOut,options)}setTimeout((function(){history.popstate=true}),17);if(back==false&&history.popstate==false){store.lastShip=[pageInto,pageOut]}else{store.lastShip=null}}};Mobilebone.remove=function(domOrId){if(!domOrId){return this}var elePage=domOrId;var pageid=domOrId;if(typeof pageid=="string"){elePage=store[pageid]}else if(elePage.tagName&&elePage.tagName.toLowerCase()=="a"){pageid=this.getCleanUrl(elePage);elePage=store[pageid]}if(elePage&&elePage.parentElement){for(var key in store){if(store[key]==elePage){delete store[key]}}elePage.parentElement.removeChild(elePage)}};Mobilebone.getCleanUrl=function(trigger,url,params){var href="",formdata="",cleanUrl="";if(trigger){if(trigger.nodeType==1){if(trigger.action){href=trigger.getAttribute("action");if(trigger.method&&trigger.method.toUpperCase()=="POST"){return href}else if(window.$&&$.fn&&$.fn.serialize){formdata=$(trigger).serialize()}else{formdata={};slice.call(trigger.querySelectorAll("input,select,textarea")).forEach((function(control){if(control.name&&!control.disabled){var val=control.value.trim(),name=control.name;if(/^radio|checkbox/i.test(control.type)){if(control.checked){if(formdata[name]){formdata[name].push(val)}else{formdata[name]=[val]}}}else{formdata[name]=[val]}}}))}}else{href=trigger.getAttribute("href");if(/^javascript/.test(href)){href=""}formdata=trigger.getAttribute("data-formdata")||trigger.getAttribute("data-params")||"";var strContainer="container",attrContainer=trigger.getAttribute("data-"+strContainer);if(formdata.indexOf(strContainer)==-1&&attrContainer){var queryContainer=strContainer+"="+attrContainer;formdata=formdata?formdata+"&"+queryContainer:queryContainer}}}else if(trigger.url){href=trigger.url;formdata=trigger.data}}if(!(href=href||url)){return""}formdata=formdata||params||"";if(typeof formdata=="object"){var arrData=[];for(key in formdata){if(!formdata[key].forEach){formdata[key]=[formdata[key]]}formdata[key].forEach((function(keyValue){arrData.push(key+"="+encodeURIComponent(keyValue))}))}if(arrData.length>0){formdata=arrData.join("&")}else{formdata=""}}cleanUrl=href.split("#")[0].replace(/&+$/,"").replace(/^\.\/+/,"");if(cleanUrl.slice(-1)=="?"){cleanUrl=cleanUrl.split("?")[0]}if(formdata!=""){if(/\?/.test(cleanUrl)){formdata=formdata.replace(/^&|\?/,"");cleanUrl=cleanUrl+"&"+formdata}else if(formdata!=""){formdata=formdata.replace("?","");cleanUrl=cleanUrl+"?"+formdata}}return cleanUrl};Mobilebone.createPage=function(domHtml,eleOrObj,options){var response=null,container=null,classPage=this.classPage,isreload=null;if(!domHtml)return;if(typeof options=="undefined"&&typeof eleOrObj=="object"){options=eleOrObj}options=options||{};var optionsTransition={};var titlePage,idContainer,classPageInside;if(eleOrObj){if(eleOrObj.nodeType==1){if(eleOrObj.href||eleOrObj.action){titlePage=eleOrObj.getAttribute("data-title")||options.title}response=options.response;idContainer=eleOrObj.getAttribute("data-container");container=document.getElementById(idContainer);classPageInside=eleOrObj.getAttribute("data-classpage");optionsTransition.target=eleOrObj;isreload=eleOrObj.getAttribute("data-reload");if(eleOrObj.tagName.toLowerCase()=="form"||isreload!==null&&isreload!="false"){optionsTransition.reload=true}optionsTransition.back=eleOrObj.getAttribute("data-rel")=="back";if(eleOrObj.getAttribute("data-history")=="false"){optionsTransition.history=false}}else{response=eleOrObj.response||options.response;titlePage=eleOrObj.title||options.title;container=eleOrObj.container||options.container;classPageInside=eleOrObj.classPage||options.classPage;optionsTransition.target=eleOrObj.target;optionsTransition.back=eleOrObj.back||options.back}if(container&&classPageInside){classPage=classPageInside}}var eleCurrentPage=(classPage==classPageInside?container:document).querySelector(".in."+classPage);var eleCreatePage=null;var create=document.createElement("div");if(typeof domHtml=="string"){create.innerHTML=domHtml}else{create.appendChild(domHtml)}if(Mobilebone.evalScript==true&&domHtml.firstintoBind!=true){slice.call(create.getElementsByTagName("script")).forEach((function(originScript){var scriptContent=originScript.innerHTML.trim();var type=originScript.type||originScript.getAttribute("type");var head=document.getElementsByTagName("head")[0]||document.documentElement;var script=document.createElement("script");if(type){script.type=type}if(scriptContent){script.appendChild(document.createTextNode(scriptContent))}else if(originScript.src&&!document.querySelector('script[src="'+originScript.src+'"]')){script.src=originScript.src}setTimeout((function(){head.insertBefore(script,head.firstChild);head.removeChild(script);script=null}),17);originScript=null}))}var eleCreateTitle=create.getElementsByTagName("title")[0];if(!(eleCreatePage=create.querySelector("."+classPage))){create.className=classPage+" out";eleCreatePage=create}if(typeof titlePage=="string"){eleCreatePage.setAttribute("data-title",titlePage)}else if(eleCreateTitle&&eleCreateTitle.innerText){eleCreatePage.setAttribute("data-title",eleCreateTitle.innerText)}optionsTransition.response=response||domHtml;optionsTransition.id=options.id||this.getCleanUrl(eleOrObj)||eleCreatePage.id||options.url||"unique"+Date.now();if(typeof options=="object"){if(typeof options.history!="undefined"){optionsTransition.history=options.history}if(typeof options.remove!="undefined"){optionsTransition.remove=options.remove}if(typeof options.target!="undefined"){optionsTransition.target=options.target}if(typeof options.title!="undefined"){optionsTransition.title=options.title}if(typeof options.query!="undefined"){optionsTransition.query=options.query}}if(classPage==classPageInside){optionsTransition.history=false;optionsTransition.classPage=classPage}container=container||document.body;if(optionsTransition.remove==true&&optionsTransition.id){this.remove(optionsTransition.id);if(options.id){slice.call(document.querySelectorAll('a[data-reload="'+options.id+'"]')).forEach((function(ele){Mobilebone.remove(ele)}))}}var pageid=optionsTransition.id.split("?")[0];if(pageid&&store[pageid]&&container.contains(store[pageid])){container.insertBefore(eleCreatePage,store[pageid])}else{container.appendChild(eleCreatePage)}create=null;this.transition(eleCreatePage,eleCurrentPage,optionsTransition);var objRelationShip=store.backShip||[];objRelationShip.push({pageIn:eleCreatePage,pageOut:eleCurrentPage,isBack:!!optionsTransition.back});store.backShip=objRelationShip};Mobilebone.getFunction=function(keys){if(typeof keys!="string")return;var fun=Mobilebone.rootTransition,arrKey=keys.split(".");for(var index=0;index<arrKey.length;index+=1){if(!(fun=fun[arrKey[index]])){break}}return fun};Mobilebone.ajax=function(eleOrObj){if(!eleOrObj){return}var trigger=eleOrObj;var defaults={url:"",type:"",dataType:"",data:{},timeout:1e4,success:function(){},error:function(){},complete:function(){}};var params={},eleMask=null,formData=null;var classMask=this.classMask;var paramsFromTrigger={},attrMask;if(eleOrObj.nodeType==1){paramsFromTrigger=_queryToObject(trigger.getAttribute("data-params")||"");for(key in defaults){params[key]=trigger.getAttribute("data-"+key)||paramsFromTrigger[key]||defaults[key];if(typeof defaults[key]=="function"&&typeof params[key]=="string"){params[key]=this.getFunction(params[key]);if(typeof params[key]!="function"){params[key]=defaults[key]}}}var cleanUrl=this.getCleanUrl(trigger,params.url);params.url=cleanUrl;var queryFromUrl=_queryToObject(cleanUrl.split("?")[1]);for(var key in queryFromUrl){if(typeof paramsFromTrigger[key]=="undefined"){paramsFromTrigger[key]=queryFromUrl[key]}}params.query=paramsFromTrigger;params.target=trigger;params.back=trigger.getAttribute("data-rel")=="back";var tagName=trigger.tagName.toLowerCase();if(tagName=="form"){params.type=trigger.method;formData=new FormData(trigger)}else if(tagName=="a"){var idContainer=trigger.getAttribute("data-container"),classPageInside=trigger.getAttribute("data-classpage"),container=idContainer&&document.getElementById(idContainer);if(container&&classPageInside&&classPageInside!=Mobilebone.classPage){params.history=false;params.title=false}var attrReload=trigger.getAttribute("data-reload");if(typeof attrReload=="string"&&attrReload!="false"){if(attrReload!=""&&attrReload!="true"){slice.call(document.querySelectorAll('a[data-reload="'+attrReload+'"]')).forEach((function(ele){Mobilebone.remove(ele)}));Mobilebone.remove(store[attrReload])}else{Mobilebone.remove(store[cleanUrl])}}}attrMask=eleOrObj.getAttribute("data-mask");if(attrMask=="true"||attrMask==""){eleMask=eleOrObj.querySelector("."+classMask)}}else if(eleOrObj.url){params=eleOrObj;for(key2 in defaults){params[key2]=eleOrObj[key2]||defaults[key2]}params.url=this.getCleanUrl(null,params.url,params.data);params.title=eleOrObj.title;params.back=eleOrObj.back;params.container=eleOrObj.container;params.query=_queryToObject(eleOrObj.url.split("?")[1])}else{return}var body=container||document.body;if(typeof attrMask!="string"){eleMask=[].slice.call(body.children).filter((function(element){return element.classList.contains(classMask)}))[0]}if(eleMask==null){eleMask=document.createElement("div");eleMask.className=classMask;eleMask.innerHTML='<s class="loading"></s>';if(typeof attrMask=="string"){eleOrObj.appendChild(eleMask)}else{body.appendChild(eleMask)}}eleMask.style.display="inline";if(this.showLoading){this.showLoading()}var xhr=new XMLHttpRequest;xhr.open(params.type||"GET",params.url+(/\?/.test(params.url)?"&":"?")+"r="+Date.now());xhr.timeout=params.timeout;xhr.onload=function(){var response=null;if(params.dataType=="json"||params.dataType=="JSON"){try{response=JSON.parse(xhr.response);params.response=response;Mobilebone.createPage(Mobilebone.jsonHandle(response,params),eleOrObj,params)}catch(e){params.message="JSON parse error："+e.message;params.error.call(params,xhr,xhr.status)}}else if(params.dataType=="unknown"){params.history=false;try{response=JSON.parse(xhr.response);params.response=response;Mobilebone.createPage(Mobilebone.jsonHandle(response,params),eleOrObj,params)}catch(e){response=xhr.response;Mobilebone.createPage(response,eleOrObj,params)}}else{response=xhr.response;Mobilebone.createPage(response,eleOrObj,params)}params.success.call(params,response,xhr.status)};xhr.onerror=function(e){params.message="Illegal request address or an unexpected network error!";params.error.call(params,xhr,xhr.status)};xhr.onloadend=function(){eleMask.style.display="none";if(this.hideLoading){this.hideLoading()}params.complete.call(params,xhr,xhr.status)};xhr.ontimeout=function(){params.message="The request timeout!";params.error.call(params,xhr,xhr.status);eleMask.style.display="none";if(this.hideLoading){this.hideLoading()}};xhr.setRequestHeader("Type","ajax");xhr.setRequestHeader("From","mobilebone");xhr.send(formData)};Mobilebone.submit=function(form){if(!form||typeof form.action!="string"){return}var ajax=form.getAttribute("data-ajax");if(ajax=="false"||Mobilebone.captureForm==false&&ajax!="true")return;form.addEventListener("submit",(function(event){var attrPrevent=this.getAttribute("data-preventdefault");var funPrevent=Mobilebone.getFunction(attrPrevent);if(typeof funPrevent=="function"&&funPrevent(this)==true){event.preventDefault();return false}Mobilebone.ajax(this);event.preventDefault()}))};Mobilebone.isBack=function(pageIn,pageOut){if(history.tempBack==true){history.tempBack=null;return true}if(history.tempGo==true){history.tempGo=null;return false}if(typeof pageIn=="undefined"){return false}if(!pageOut){return false}var objRelationShip=store.backShip||[];var isBack=null;objRelationShip.forEach((function(ship){if(ship.pageIn==pageIn&&ship.pageOut==pageOut){isBack=ship.isBack}else if(ship.pageIn==pageOut&&ship.pageOut==pageIn){isBack=!ship.isBack}}));if(isBack===null){isBack=!!(pageIn.compareDocumentPosition(pageOut)&Node.DOCUMENT_POSITION_FOLLOWING)}return isBack};Mobilebone.jsonHandle=function(json,params){return'<p style="text-align:center;">Dear master, if you see me, show that JSON parsing function is undefined!</p>'},Mobilebone.init=function(){if(hasInited==true)return"Don't repeat initialization!";var hash=location.hash.replace("#&","#"),eleIn=null,container=null;var key=hash.split("?")[0];var query=hash.split("?")[1];var options={query:{}};if(query){options.query=_queryToObject(query)}if(key==""||key=="#"){this.transition(document.querySelector("."+this.classPage))}else if(isSimple.test(key)==true&&(eleIn=document.querySelector(key))&&eleIn.classList.contains(this.classPage)){options.id=hash.replace(/^#/,"");this.transition(eleIn,null,options)}else{if(hash.split("container=").length==2){container=document.getElementById(hash.split("container=")[1].split("&")[0])}this.ajax({url:hash.replace("#",""),dataType:"unknown",container:container,error:function(){options.id=hash.replace(/^#/,"");eleIn=document.querySelector("."+Mobilebone.classPage);Mobilebone.transition(eleIn,null,options)}})}document.addEventListener("click",this.handleTapEvent);var isSafari7=!!navigator.userAgent.match(/safari/i)&&!navigator.userAgent.match(/chrome/i)&&typeof document.hidden!=="undefined"&&!window.chrome;if("ontouchstart"in window==true&&isSafari7){document.addEventListener("touchmove",(function(){history.popstateswipe=true}));document.addEventListener("touchend",(function(){history.popstateswipe=false}))}hasInited=true};Mobilebone.handleTapEvent=function(event){var target=null;if(event&&event.nodeType==1){target=event;target.preventDefault=function(){}}target=(target||event.target)&&(target||event.target).closest("a");if(!target){return}var href=target.href;var selfPage=document.querySelector(".in."+Mobilebone.classPage);if(selfPage==null){return}var options={target:target};var attrPrevent=target.getAttribute("data-preventdefault")||_queryToObject(target.getAttribute("data-params")||"").preventdefault;var funPrevent=Mobilebone.getFunction(attrPrevent);if(typeof funPrevent=="function"&&funPrevent(target)==true){event.preventDefault();return false}var eleMask=target.getElementsByClassName(Mobilebone.classMask)[0];if(eleMask&&eleMask.style.display!="none"){event.preventDefault();return false}var idContainer=target.getAttribute("data-container");var classPageInside=target.getAttribute("data-classpage");var container=idContainer&&document.getElementById(idContainer);if(container&&classPageInside&&classPageInside!=Mobilebone.classPage){selfPage=container.querySelector(".in."+classPageInside)||container.querySelector(classPageInside);options.history=false;options.title=false;options.classPage=classPageInside}if(target.getAttribute("data-history")=="false"){options.history=false}var capture=Mobilebone.captureLink==true;var rel=target.getAttribute("data-rel");if(!rel){rel="auto"}var back=false;if(rel=="back"){back=true}var go;if(rel=="go"){go=true}var external=rel=="external";if(!href){return}var attrHref=target.getAttribute("href");href=href.replace("#&","#");if(attrHref.replace(/#/g,"")===""){event.preventDefault();return}if(/^javascript/.test(href)){if(back==false&&!go){return}}else{external=external||href.replace("://","").split("/")[0]!==location.href.replace("://","").split("/")[0];if((external==true||capture==false)&&target.getAttribute("data-ajax")!="true"){return}}if(/^#/.test(attrHref)==true){event.preventDefault();var hashTargetPage=href.split("#")[1];var idTargetPage=hashTargetPage.split("?")[0];var queryTargetPage=hashTargetPage.split("?")[1];var paramTargetPage=target.getAttribute("data-formdata")||target.getAttribute("data-params");if(paramTargetPage){queryTargetPage=queryTargetPage+"&"+paramTargetPage}options.query=_queryToObject(queryTargetPage);options.id=hashTargetPage;var eleTargetPage=idTargetPage&&document.getElementById(idTargetPage);if(back==false&&rel=="auto"){back=Mobilebone.isBack(eleTargetPage,selfPage)}if(eleTargetPage){var lastShip=store.lastShip;if(lastShip&&eleTargetPage==lastShip[1]&&selfPage==lastShip[0]&&!go){history.tempBack=true;history.back()}else{Mobilebone.transition(eleTargetPage,selfPage,back,options)}}}else if(/^javascript/.test(href)){if(back){history.tempBack=true;history.back()}else if(go){history.tempGo=true;history.go(1)}}else if(target.getAttribute("data-ajax")!="false"){event.preventDefault();var cleanUrl=Mobilebone.getCleanUrl(target);options.query=_queryToObject(cleanUrl.split("?")[1]);var attrReload=target.getAttribute("data-reload");if((attrReload==null||attrReload=="false")&&store[cleanUrl]){if(back==false&&rel=="auto"){back=Mobilebone.isBack(store[cleanUrl],selfPage)}options.id=cleanUrl;var body=container||document.body;if(body.contains(store[cleanUrl])==false){body.appendChild(store[cleanUrl])}Mobilebone.transition(store[cleanUrl],selfPage,back,options)}else{Mobilebone.ajax(target)}}};if(!Element.prototype.matches){Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector}if(!Element.prototype.closest){Element.prototype.closest=function(s){var el=this;do{if(el.matches(s))return el;el=el.parentElement||el.parentNode}while(el!==null&&el.nodeType===1);return null}}var _queryToObject=function(string){var obj={};if(typeof string=="string"){string.split("&").forEach((function(part){var arrPart=part.split("=");if(arrPart.length>1){obj[arrPart[0]]=part.replace(arrPart[0]+"=","")}}))}return obj};window.addEventListener("DOMContentLoaded",(function(){if(hasInited==false&&Mobilebone.autoInit==true){Mobilebone.init()}}));window.addEventListener("popstate",(function(){if(history.popstateswipe==true){location.reload();history.popstateswipe=false;return}if(history.popstate==false){history.popstate=true;return}var hash=location.hash.replace("#&","#").replace(/^#/,"");var key=hash.split("?")[0];var pageIn=null;var pageOut=document.querySelector(".in."+Mobilebone.classPage);var container=null;if(hash==""){pageIn=document.querySelector("."+Mobilebone.classPage);if(pageIn.id)return}else{pageIn=store[key]||store[hash];if(hash.split("container=").length==2){container=document.getElementById(hash.split("container=")[1].split("&")[0])}if(pageIn&&isSimple.test(key)==false){Mobilebone.transition(pageIn,pageOut,Mobilebone.isBack(pageIn,pageOut),{id:hash,history:false,container:container,target:document.activeElement,query:_queryToObject(hash.split("?")[1])});return}}if(!pageIn){if(isSimple.test(hash)==false){Mobilebone.ajax({url:hash,dataType:"unknown",back:Mobilebone.isBack(),container:container});return}pageIn=document.querySelector("#"+key)||document.querySelector("#"+hash)}if(pageIn&&pageIn==pageOut||Mobilebone.pushStateEnabled==false)return;if(pageIn){Mobilebone.transition(pageIn,pageOut,Mobilebone.isBack(pageIn,pageOut),{id:hash,history:false,target:document.activeElement,query:_queryToObject(hash.split("?")[1])})}}));document.MBLOADED=true;return Mobilebone}));